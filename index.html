<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeptEvents Pro - University Event Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;600;800&display=swap');
        :root { --primary: #6366f1; --bg-dark: #020617; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-dark); color: #e2e8f0; overflow-x: hidden; }
        .orbitron { font-family: 'Orbitron', sans-serif; }
        .stars-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: radial-gradient(circle at top right, #1e1b4b 0%, #020617 100%); overflow: hidden; }
        .star { position: absolute; background: white; border-radius: 50%; opacity: 0.5; animation: twinkle var(--duration) infinite ease-in-out; }
        @keyframes twinkle { 0%, 100% { opacity: 0.3; transform: scale(1); } 50% { opacity: 1; transform: scale(1.2); } }
        .marquee { white-space: nowrap; overflow: hidden; display: inline-block; animation: marquee 25s linear infinite; }
        @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .view-section { display: none; opacity: 0; transform: translateY(20px); transition: all 0.5s ease-out; }
        .view-section.active { display: block; opacity: 1; transform: translateY(0); }
        #mobile-menu { transition: all 0.3s ease-in-out; max-height: 0; overflow: hidden; }
        #mobile-menu.open { max-height: 500px; padding: 1rem 0; }
        .media-card:hover .overlay { opacity: 1; }
    </style>
</head>
<body>
    <div class="stars-container" id="stars"></div>

    <!-- Notification Bar -->
    <div id="notif-bar" class="bg-indigo-600/20 backdrop-blur-md border-b border-indigo-500/30 py-2 hidden">
        <div class="container mx-auto px-4 overflow-hidden">
            <div id="notif-text" class="marquee text-[10px] font-black uppercase tracking-[0.2em] text-indigo-300"></div>
        </div>
    </div>

    <!-- Navigation -->
    <header class="glass sticky top-0 z-50 border-b border-white/10">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-5">
                <div class="flex items-center space-x-3 cursor-pointer group" onclick="showView('home-view')">
                    <div class="bg-indigo-600 p-2 rounded-xl group-hover:rotate-12 transition-all">
                        <i class="fas fa-graduation-cap text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="orbitron text-xl font-black tracking-tighter uppercase leading-none">Dept<span class="text-indigo-500">Events</span></h1>
                        <span class="text-[10px] text-indigo-400 font-bold tracking-widest uppercase">Pro Edition 2026</span>
                    </div>
                </div>
                <nav class="hidden lg:block">
                    <ul class="flex space-x-8 text-[11px] font-black uppercase tracking-widest items-center">
                        <li><a href="javascript:void(0)" onclick="showView('home-view')" class="hover:text-indigo-400 transition">Events</a></li>
                        <li><a href="javascript:void(0)" onclick="showView('register-view')" class="hover:text-indigo-400 transition">Register</a></li>
                        <li><a href="javascript:void(0)" onclick="showView('status-view')" class="hover:text-indigo-400 transition">My Status</a></li>
                        <li><a href="javascript:void(0)" onclick="showView('admin-view')" class="bg-white/10 px-5 py-2.5 rounded-full hover:bg-indigo-600 transition border border-white/10">Admin Panel</a></li>
                    </ul>
                </nav>
                <button onclick="toggleMobileMenu()" class="lg:hidden text-2xl p-2"><i id="menu-icon" class="fas fa-bars"></i></button>
            </div>
            <div id="mobile-menu" class="lg:hidden">
                <ul class="flex flex-col space-y-4 font-black uppercase text-sm border-t border-white/5 pt-4 pb-4">
                    <li><a href="javascript:void(0)" onclick="showView('home-view'); toggleMobileMenu()">Events</a></li>
                    <li><a href="javascript:void(0)" onclick="showView('register-view'); toggleMobileMenu()">Register</a></li>
                    <li><a href="javascript:void(0)" onclick="showView('status-view'); toggleMobileMenu()">My Status</a></li>
                    <li><a href="javascript:void(0)" onclick="showView('admin-view'); toggleMobileMenu()" class="text-indigo-400">Admin Panel</a></li>
                </ul>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-12">
        <!-- HOME VIEW -->
        <section id="home-view" class="view-section active">
            <div class="max-w-4xl mx-auto text-center mb-16">
                <span class="bg-indigo-500/20 text-indigo-400 border border-indigo-500/30 px-5 py-2 rounded-full text-[10px] font-black uppercase tracking-[0.3em] mb-6 inline-block">University Events Portal</span>
                <h2 class="orbitron text-4xl md:text-6xl font-black text-white mb-6">Upcoming <span class="text-indigo-500">Events</span></h2>
            </div>
            <div id="events-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-20"></div>

        </section>

        <!-- EVENT HIGHLIGHTS VIEW (Specific Event) -->
        <section id="highlights-view" class="view-section">
            <div class="max-w-6xl mx-auto">
                <div class="flex flex-col md:flex-row justify-between items-center mb-12 gap-6">
                    <div>
                        <button onclick="showView('home-view')" class="text-indigo-400 text-[10px] font-black uppercase tracking-widest mb-2 flex items-center hover:text-white transition">
                            <i class="fas fa-arrow-left mr-2"></i> Back to Events
                        </button>
                        <h2 id="highlight-event-title" class="orbitron text-3xl md:text-5xl font-black text-white uppercase tracking-tighter"></h2>
                    </div>
                    <div class="w-24 h-1 bg-indigo-600 hidden md:block rounded-full"></div>
                </div>
                <div id="event-media-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8"></div>
                <div id="no-media-msg" class="hidden text-center py-20">
                    <i class="fas fa-photo-video text-6xl text-white/10 mb-6"></i>
                    <p class="orbitron text-white/40 font-bold uppercase tracking-widest">No highlights available for this event yet.</p>
                </div>
            </div>
        </section>

        <!-- REGISTER VIEW -->
        <section id="register-view" class="view-section">
            <div class="max-w-3xl mx-auto glass rounded-3xl overflow-hidden">
                <div class="bg-indigo-600/20 py-8 px-8 border-b border-white/10">
                    <h2 class="orbitron text-2xl font-bold text-white">Student Registration</h2>
                </div>
                <form id="registration-form" class="p-8 space-y-8">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="md:col-span-2">
                            <label class="block text-[10px] font-black uppercase text-indigo-400 tracking-widest mb-3">Select Event</label>
                            <select id="reg-event-select" required class="w-full px-5 py-4 bg-white/5 border border-white/10 rounded-2xl text-white outline-none"></select>
                        </div>
                        <input type="text" id="reg-name" required placeholder="Full Name" class="w-full px-5 py-4 bg-white/5 border border-white/10 rounded-2xl text-white outline-none">
                        <input type="text" id="reg-id" required placeholder="Student ID (FA21-BCS-000)" class="w-full px-5 py-4 bg-white/5 border border-white/10 rounded-2xl text-white outline-none">
                        <input type="email" id="reg-email" required placeholder="Email Address" class="w-full px-5 py-4 bg-white/5 border border-white/10 rounded-2xl text-white outline-none">
                        <input type="tel" id="reg-phone" required placeholder="Phone Number" class="w-full px-5 py-4 bg-white/5 border border-white/10 rounded-2xl text-white outline-none">
                        <div id="reg-pay-section" class="md:col-span-2 hidden">
                            <label class="block text-[10px] font-black uppercase text-rose-400 tracking-widest mb-3">Upload Payment Receipt (Screenshot)</label>
                            <input type="file" id="reg-pay-file" accept="image/*" class="w-full px-5 py-4 bg-white/5 border border-white/10 rounded-2xl text-white outline-none">
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-indigo-600 text-white orbitron font-bold py-5 rounded-2xl uppercase tracking-widest hover:bg-indigo-500 transition">Submit Registration</button>
                </form>
            </div>
        </section>

        <!-- STATUS VIEW -->
        <section id="status-view" class="view-section">
            <div class="max-w-2xl mx-auto glass p-12 rounded-3xl text-center">
                <h2 class="orbitron text-2xl font-black text-white mb-8 uppercase">Check Your Status</h2>
                <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4 mb-10">
                    <input type="text" id="search-student-id" placeholder="Enter Student ID" class="flex-grow px-6 py-5 bg-white/5 border border-white/10 rounded-2xl text-white outline-none text-center">
                    <button onclick="checkStudentStatus()" class="bg-indigo-600 text-white px-10 py-5 rounded-2xl font-black uppercase tracking-widest hover:bg-indigo-500">Search</button>
                </div>
                <div id="status-results" class="space-y-4 text-left"></div>
            </div>
        </section>

        <!-- ADMIN VIEW -->
        <section id="admin-view" class="view-section">
            <!-- LOGIN -->
            <div id="admin-login-box" class="max-w-md mx-auto glass p-10 rounded-3xl text-center">
                <h2 class="orbitron text-2xl font-bold mb-8 text-white uppercase">Admin Access</h2>
                <input type="password" id="admin-pass" placeholder="Authorization Key" class="w-full px-5 py-4 bg-white/5 border border-white/10 rounded-2xl outline-none text-white text-center mb-6">
                <button onclick="loginAdmin()" class="w-full bg-indigo-600 text-white py-4 rounded-2xl font-black uppercase tracking-widest hover:bg-indigo-500">Authenticate</button>
                <p id="login-error" class="text-rose-500 text-[10px] mt-4 hidden">ACCESS DENIED: INVALID KEY</p>
            </div>

            <!-- DASHBOARD -->
            <div id="admin-dashboard" class="hidden space-y-12">
                <div class="flex flex-col md:flex-row justify-between items-center gap-6 border-b border-white/10 pb-8">
                    <h2 class="orbitron text-3xl font-black text-white uppercase">Admin <span class="text-indigo-500">Dashboard</span></h2>
                    <div class="flex flex-wrap gap-3">
                        <button onclick="showAdminTab('events')" class="bg-indigo-600 text-white px-6 py-3 rounded-xl text-[10px] font-black uppercase">Events</button>
                        <button onclick="showAdminTab('media')" class="bg-indigo-600 text-white px-6 py-3 rounded-xl text-[10px] font-black uppercase">Manage Gallery</button>
                        <button onclick="showAdminTab('settings')" class="bg-slate-800 text-white px-6 py-3 rounded-xl text-[10px] font-black uppercase">Settings</button>
                        <button onclick="logoutAdmin()" class="bg-rose-500/20 text-rose-500 px-6 py-3 rounded-xl text-[10px] font-black uppercase">Logout</button>
                    </div>
                </div>

                <!-- EVENTS TAB -->
                <div id="admin-tab-events" class="space-y-10">
                    <div class="glass p-8 rounded-3xl">
                        <h3 class="orbitron text-xl font-black mb-8 text-indigo-400 uppercase">Create Event</h3>
                        <form id="add-event-form" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <input type="text" id="ev-title" placeholder="Event Title" required class="md:col-span-2 px-5 py-4 bg-white/5 border border-white/10 rounded-2xl text-white outline-none">
                            <select id="ev-category" required class="px-5 py-4 bg-white/5 border border-white/10 rounded-2xl text-white outline-none">
                                <option value="" class="bg-white text-black">Category...</option>
                                <option value="Workshop" class="bg-white text-black">Workshop</option>
                                <option value="Seminar" class="bg-white text-black">Seminar</option>
                                <option value="Competition" class="bg-white text-black">Competition</option>
                            </select>
                            <input type="date" id="ev-date" required class="px-5 py-4 bg-white/5 border border-white/10 rounded-2xl text-white">
                            <input type="time" id="ev-time" required class="px-5 py-4 bg-white/5 border border-white/10 rounded-2xl text-white">
                            <input type="datetime-local" id="ev-deadline" required class="px-5 py-4 bg-white/5 border border-white/10 rounded-2xl text-white">
                            <input type="text" id="ev-location" placeholder="Location (Hall A, Lab 1 etc.)" required class="md:col-span-3 px-5 py-4 bg-white/5 border border-white/10 rounded-2xl text-white outline-none">
                            <textarea id="ev-desc" placeholder="Event Description..." required class="md:col-span-3 px-5 py-4 bg-white/5 border border-white/10 rounded-2xl text-white h-24 outline-none"></textarea>
                            <div class="md:col-span-3 grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="flex items-center space-x-3 bg-white/5 p-4 rounded-2xl border border-white/10">
                                    <input type="checkbox" id="ev-pay-required" class="w-5 h-5 accent-indigo-600">
                                    <label for="ev-pay-required" class="text-xs font-black uppercase tracking-widest text-indigo-300">Require Payment Screenshot?</label>
                                </div>
                                <div class="flex items-center space-x-3 bg-white/5 p-4 rounded-2xl border border-white/10">
                                    <input type="checkbox" id="ev-show-highlights" class="w-5 h-5 accent-indigo-600" checked>
                                    <label for="ev-show-highlights" class="text-xs font-black uppercase tracking-widest text-indigo-300">Show Highlights Button?</label>
                                </div>
                            </div>
                            <button type="submit" class="md:col-span-3 bg-indigo-600 text-white orbitron py-5 rounded-2xl font-black uppercase">Publish Event</button>
                        </form>
                    </div>
                    <div class="glass rounded-3xl overflow-x-auto">
                        <table class="w-full text-left text-sm">
                            <thead class="bg-white/5 font-black uppercase text-indigo-400 text-[10px]">
                                <tr><th class="px-8 py-5">Event</th><th class="px-8 py-5">Location</th><th class="px-8 py-5">Regs</th><th class="px-8 py-5">Action</th></tr>
                            </thead>
                            <tbody id="admin-events-table" class="divide-y divide-white/5"></tbody>
                        </table>
                    </div>
                </div>

                <!-- QUESTION MODAL -->
                <div id="question-modal" class="fixed inset-0 bg-black/90 backdrop-blur-xl hidden z-[100] flex items-center justify-center p-4">
                    <div class="glass w-full max-w-2xl rounded-3xl p-8 max-h-[90vh] overflow-y-auto">
                        <div class="flex justify-between items-center mb-8">
                            <h3 class="orbitron text-xl font-black text-white">MANAGE CUSTOM FORM</h3>
                            <button onclick="closeQuestionModal()" class="text-white hover:text-rose-500 text-2xl"><i class="fas fa-times"></i></button>
                        </div>
                        <div id="q-manager-content">
                            <div class="bg-white/5 p-6 rounded-2xl mb-8 border border-white/10">
                                <label class="block text-[10px] font-black uppercase text-indigo-400 mb-3">Add New Question</label>
                                <div class="space-y-4">
                                    <input type="text" id="new-q-text" placeholder="Question Text (e.g. T-Shirt Size)" class="w-full px-5 py-4 bg-white/10 border border-white/10 rounded-xl text-white outline-none">
                                    <select id="new-q-type" onchange="toggleOptionsInput()" class="w-full px-5 py-4 bg-white/10 border border-white/10 rounded-xl text-white outline-none">
                                        <option value="text" class="bg-slate-900 text-white">Text Answer</option>
                                        <option value="mcq" class="bg-slate-900 text-white">Multiple Choice</option>
                                    </select>
                                    <div id="mcq-options-container" class="hidden">
                                        <input type="text" id="new-q-options" placeholder="Options (comma separated: S, M, L, XL)" class="w-full px-5 py-4 bg-white/10 border border-white/10 rounded-xl text-white outline-none">
                                    </div>
                                    <button onclick="addCustomQuestion()" class="w-full bg-indigo-600 text-white py-4 rounded-xl font-black uppercase tracking-widest hover:bg-indigo-500">Add to Form</button>
                                </div>
                            </div>
                            <div id="q-list" class="space-y-4"></div>
                        </div>
                    </div>
                </div>

                <!-- DETAILS MODAL -->
                <div id="details-modal" class="fixed inset-0 bg-black/90 backdrop-blur-xl hidden z-[100] flex items-center justify-center p-4">
                    <div class="glass w-full max-w-lg rounded-3xl p-8">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="orbitron text-xl font-black text-white">STUDENT ANSWERS</h3>
                            <button onclick="closeDetailsModal()" class="text-white hover:text-rose-500"><i class="fas fa-times text-2xl"></i></button>
                        </div>
                        <div id="details-content" class="space-y-4"></div>
                    </div>
                </div>

                <!-- MEDIA TAB -->
                <div id="admin-tab-media" class="hidden space-y-10">
                    <div class="glass p-8 rounded-3xl">
                        <div class="flex justify-between items-center mb-8">
                            <h3 class="orbitron text-xl font-black text-indigo-400 uppercase">Manage Media Gallery</h3>
                            <button onclick="toggleGalleryVisibility()" id="gallery-toggle-btn" class="px-6 py-2 rounded-xl text-[10px] font-black uppercase border"></button>
                        </div>
                        <form id="upload-media-form" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <input type="text" id="media-title" placeholder="Media Title" required class="md:col-span-2 px-5 py-4 bg-white/5 border border-white/10 rounded-2xl text-white outline-none">
                            <select id="media-type" required class="px-5 py-4 bg-white/5 border border-white/10 rounded-2xl text-white outline-none">
                                <option value="image" class="bg-white text-black">Image</option>
                                <option value="video" class="bg-white text-black">Video</option>
                            </select>
                            <div class="md:col-span-3">
                                <label class="block text-[10px] font-black text-indigo-300 uppercase mb-2">Associate with Event</label>
                                <select id="media-event-id" required class="w-full px-5 py-4 bg-white/5 border border-white/10 rounded-2xl text-white outline-none">
                                    <option value="" class="bg-white text-black">Select Event...</option>
                                </select>
                            </div>
                            <div class="md:col-span-3">
                                <label class="block text-[10px] font-black text-indigo-300 uppercase mb-2">Select File from Computer</label>
                                <input type="file" id="media-file" accept="image/*,video/*" required class="w-full px-5 py-4 bg-white/5 border border-white/10 rounded-2xl text-white outline-none">
                            </div>
                            <button type="submit" class="md:col-span-3 bg-indigo-600 text-white orbitron py-5 rounded-2xl font-black uppercase">Upload to Cloud</button>
                        </form>
                    </div>
                    <div class="glass rounded-3xl overflow-hidden">
                        <table class="w-full text-left text-sm">
                            <thead class="bg-white/5 font-black uppercase text-indigo-400 text-[10px]">
                                <tr><th class="px-8 py-5">Media</th><th class="px-8 py-5">Type</th><th class="px-8 py-5">Action</th></tr>
                            </thead>
                            <tbody id="admin-media-table" class="divide-y divide-white/5"></tbody>
                        </table>
                    </div>
                </div>

                <!-- SETTINGS TAB -->
                <div id="admin-tab-settings" class="hidden space-y-10">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                        <div class="glass p-8 rounded-3xl">
                            <h3 class="orbitron text-xl font-black mb-6 text-indigo-400 uppercase">Change Admin Password</h3>
                            <input type="password" id="new-admin-pass" placeholder="New Password" class="w-full px-5 py-4 bg-white/5 border border-white/10 rounded-2xl text-white outline-none mb-4">
                            <button onclick="changeAdminPassword()" class="w-full bg-slate-800 text-white py-4 rounded-2xl font-black uppercase">Update Password</button>
                        </div>
                        <div class="glass p-8 rounded-3xl">
                            <h3 class="orbitron text-xl font-black mb-6 text-indigo-400 uppercase">Notification Bar</h3>
                            <input type="text" id="notif-input" placeholder="Marquee Text" class="w-full px-5 py-4 bg-white/5 border border-white/10 rounded-2xl text-white outline-none mb-4">
                            <div class="flex space-x-3">
                                <button onclick="updateNotif()" class="flex-grow bg-indigo-600 text-white py-4 rounded-2xl font-black uppercase">Update Text</button>
                                <button onclick="toggleNotifVis()" id="notif-toggle-btn" class="px-6 py-4 rounded-2xl font-black uppercase border border-rose-500/30"></button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- REGISTRATIONS TABLE -->
                <div class="glass rounded-3xl overflow-hidden">
                    <div class="bg-white/5 px-8 py-6 flex flex-col md:flex-row justify-between items-center gap-4">
                        <span class="orbitron font-black text-white uppercase">Student Records</span>
                        <div class="flex space-x-3 w-full md:w-auto">
                            <input type="text" id="admin-reg-search" oninput="renderAdminRegs()" placeholder="Search Name/ID..." class="px-6 py-3 bg-white/5 border border-white/10 rounded-xl text-xs text-white outline-none flex-grow">
                            <button onclick="exportCSV()" class="bg-emerald-500/20 text-emerald-400 border border-emerald-500/20 px-6 py-3 rounded-xl text-[10px] font-black uppercase">Export CSV</button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm">
                            <thead class="bg-white/5 font-black uppercase text-[10px] text-gray-500">
                                <tr><th class="px-8 py-5">Student</th><th class="px-8 py-5">Event</th><th class="px-8 py-5">Receipt</th><th class="px-8 py-5">Date</th><th class="px-8 py-5">Action</th></tr>
                            </thead>
                            <tbody id="admin-regs-table" class="divide-y divide-white/5"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="border-t border-white/5 py-12 text-center">
        <h2 class="orbitron text-xl font-black text-white/40 tracking-[0.5em] mb-4">DeptEvents Pro</h2>
        <p class="text-[10px] text-indigo-400/50 font-black uppercase tracking-widest">&copy; 2026 University Event Portal - All Rights Reserved</p>
    </footer>

    <!-- Video Modal -->
    <div id="video-modal" class="fixed inset-0 bg-black/95 backdrop-blur-xl hidden z-[100] flex items-center justify-center p-4">
        <button onclick="closeVideoModal()" class="absolute top-10 right-10 text-white text-4xl hover:text-indigo-400 transition"><i class="fas fa-times"></i></button>
        <div id="video-container" class="w-full max-w-5xl aspect-video rounded-3xl overflow-hidden shadow-2xl bg-black"></div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBdwEMdKLdlJzNDXXaTQ3BMcMe5gvC_mbc",
            authDomain: "deptevents-2ff03.firebaseapp.com",
            databaseURL: "https://deptevents-2ff03-default-rtdb.firebaseio.com",
            projectId: "deptevents-2ff03",
            storageBucket: "deptevents-2ff03.firebasestorage.app",
            messagingSenderId: "80167810331",
            appId: "1:80167810331:web:c72d334e2e0fd8e7940fbe"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let events = [], registrations = [], media = [], questions = {}, adminPass = "admin123", notifText = "", notifShow = true, galleryShow = true;
        let activeEventIdForQuestions = null;

        function initData() {
            db.ref('events').on('value', snap => {
                const data = snap.val() || {};
                events = Object.keys(data).map(key => ({ ...data[key], firebaseKey: key }));
                refreshAll();
            });
            db.ref('questions').on('value', snap => {
                questions = snap.val() || {};
                if (activeEventIdForQuestions) renderQuestions(activeEventIdForQuestions);
                // Also update reg form if current event is selected
                const sel = document.getElementById('reg-event-select');
                if (sel && sel.value) updateRegFormQuestions(sel.value);
            });
            db.ref('registrations').on('value', snap => {
                const data = snap.val() || {};
                registrations = Object.keys(data).map(key => ({ ...data[key], firebaseKey: key }));
                renderAdminRegs();
            });
            db.ref('media').on('value', snap => {
                const data = snap.val() || {};
                media = Object.keys(data).map(key => ({ ...data[key], firebaseKey: key }));
                renderMedia();
            });
            db.ref('settings').on('value', snap => {
                const s = snap.val() || {};
                adminPass = s.pass || "admin123";
                notifText = s.notifText || "Welcome to DeptEvents Pro 2026!";
                notifShow = s.notifShow !== false;
                galleryShow = s.galleryShow !== false;
                refreshUI();
            });
        }

        function showView(view) {
            document.querySelectorAll('.view-section').forEach(v => v.classList.remove('active'));
            setTimeout(() => document.getElementById(view).classList.add('active'), 50);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function showAdminTab(tab) {
            ['events', 'media', 'settings'].forEach(t => document.getElementById('admin-tab-' + t).classList.add('hidden'));
            document.getElementById('admin-tab-' + tab).classList.remove('hidden');
        }

        function refreshAll() { renderHomeEvents(); populateRegDropdown(); renderAdminEvents(); populateMediaEventDropdown(); }

        function refreshUI() {
            const bar = document.getElementById('notif-bar');
            document.getElementById('notif-text').innerText = notifText;
            document.getElementById('notif-input').value = notifText;
            notifShow ? bar.classList.remove('hidden') : bar.classList.add('hidden');
            
            const nBtn = document.getElementById('notif-toggle-btn');
            nBtn.innerText = notifShow ? "Hide Bar" : "Show Bar";
            nBtn.className = notifShow ? "px-6 py-4 rounded-2xl font-black uppercase border border-rose-500/30 text-rose-500" : "px-6 py-4 rounded-2xl font-black uppercase border border-emerald-500/30 text-emerald-500";
            
            const gBtn = document.getElementById('gallery-toggle-btn');
            gBtn.innerText = galleryShow ? "Hide Gallery System" : "Show Gallery System";
            gBtn.className = galleryShow ? "px-6 py-2 rounded-xl text-[10px] font-black uppercase border border-rose-500 text-rose-500" : "px-6 py-2 rounded-xl text-[10px] font-black uppercase border border-emerald-500 text-emerald-500";
        }

        function renderHomeEvents() {
            const grid = document.getElementById('events-grid');
            grid.innerHTML = "";
            const now = Date.now();
            events.forEach(ev => {
                const deadline = new Date(ev.deadline).getTime();
                const expired = now > deadline;
                const timeLeft = deadline - now;
                let countdown = "";
                if (expired) countdown = `<span class="text-rose-500 text-[10px] font-black uppercase">Registration Closed</span>`;
                else {
                    const d = Math.floor(timeLeft / 864e5), h = Math.floor((timeLeft % 864e5) / 36e5), m = Math.floor((timeLeft % 36e5) / 6e4);
                    countdown = `<span class="text-indigo-400 text-[10px] font-black uppercase">Closes: ${d}d ${h}h ${m}m</span>`;
                }

                const desc = ev.desc || "No description provided.";
                const isLong = desc.length > 100;
                const displayDesc = isLong ? desc.substring(0, 100) + "..." : desc;

                grid.innerHTML += `
                    <div class="glass p-8 rounded-3xl relative overflow-hidden group">
                        <div class="flex justify-between items-start mb-6">
                            <span class="bg-indigo-600/20 text-indigo-300 px-3 py-1 rounded-lg text-[9px] font-black uppercase">${ev.category}</span>
                            ${countdown}
                        </div>
                        <h3 class="orbitron text-xl font-black text-white mb-4">${ev.title}</h3>
                        
                        <!-- Description Section -->
                        <div class="mb-6">
                            <p class="text-xs text-gray-300 leading-relaxed" id="desc-text-${ev.id}">${displayDesc}</p>
                            ${isLong ? `<button onclick="toggleDesc(${ev.id})" id="desc-btn-${ev.id}" class="text-indigo-400 text-[9px] font-black uppercase mt-2 tracking-widest hover:text-white transition">View More</button>` : ''}
                        </div>

                        <div class="space-y-3 text-xs text-gray-400 mb-8">
                            <p><i class="fas fa-calendar-alt w-6 text-indigo-500"></i> ${ev.date} @ ${ev.time}</p>
                            <p><i class="fas fa-map-marker-alt w-6 text-indigo-500"></i> ${ev.location}</p>
                        </div>
                        
                        <div class="flex flex-col space-y-3">
                            <button onclick="registerClick(${ev.id})" ${expired ? 'disabled' : ''} class="w-full py-4 rounded-xl font-black text-[10px] uppercase transition ${expired ? 'bg-white/5 text-white/20' : 'bg-indigo-600 text-white hover:bg-indigo-500'}">${expired ? 'Closed' : 'Register Now'}</button>
                            ${ev.showHighlights !== false ? `<button onclick="openHighlights(${ev.id})" class="w-full py-4 rounded-xl font-black text-[10px] uppercase transition border border-indigo-500/30 text-indigo-400 hover:bg-indigo-500/10">Visit Highlights</button>` : ''}
                        </div>
                    </div>`;
            });
        }

        function toggleDesc(id) {
            const ev = events.find(x => x.id == id);
            const textEl = document.getElementById(`desc-text-${id}`);
            const btnEl = document.getElementById(`desc-btn-${id}`);
            
            if (btnEl.innerText === "VIEW MORE") {
                textEl.innerText = ev.desc;
                btnEl.innerText = "VIEW LESS";
            } else {
                textEl.innerText = ev.desc.substring(0, 100) + "...";
                btnEl.innerText = "VIEW MORE";
            }
        }

        function renderMedia() {
            const adminTable = document.getElementById('admin-media-table');
            adminTable.innerHTML = "";
            media.forEach(m => {
                const ev = events.find(x => String(x.id) === String(m.eventId));
                adminTable.innerHTML += `
                    <tr>
                        <td class="px-8 py-5 text-white font-bold">${m.title}<br><span class="text-[9px] text-indigo-400 uppercase">${ev ? ev.title : 'No Event'}</span></td>
                        <td class="px-8 py-5 uppercase text-[10px] font-black">${m.type}</td>
                        <td class="px-8 py-5"><button onclick="deleteMedia(${m.id})" class="text-rose-500"><i class="fas fa-trash"></i></button></td>
                    </tr>`;
            });
        }

        function openHighlights(eventId) {
            const ev = events.find(x => String(x.id) === String(eventId));
            if (!ev) return;
            
            document.getElementById('highlight-event-title').innerText = ev.title;
            const grid = document.getElementById('event-media-grid');
            const noMedia = document.getElementById('no-media-msg');
            grid.innerHTML = "";
            
            const eventMedia = media.filter(m => String(m.eventId) === String(eventId));
            
            if (eventMedia.length === 0) {
                noMedia.classList.remove('hidden');
                grid.classList.add('hidden');
            } else {
                noMedia.classList.add('hidden');
                grid.classList.remove('hidden');
                eventMedia.forEach(m => {
                    const isVid = m.type === 'video';
                    grid.innerHTML += `
                        <div class="glass rounded-2xl overflow-hidden media-card cursor-pointer group relative aspect-square" onclick="openMediaModal('${m.url}', '${m.type}')">
                            ${isVid ? `<video class="w-full h-full object-cover opacity-50"><source src="${m.url}"></video>` : `<img src="${m.url}" class="w-full h-full object-cover opacity-80 group-hover:scale-110 transition duration-500">`}
                            <div class="overlay absolute inset-0 bg-indigo-900/40 opacity-0 flex flex-col items-center justify-center transition">
                                <div class="w-12 h-12 bg-white/20 backdrop-blur rounded-full flex items-center justify-center text-white mb-3">
                                    <i class="fas ${isVid ? 'fa-play' : 'fa-search-plus'}"></i>
                                </div>
                                <span class="text-[10px] font-black uppercase text-white tracking-widest">${m.title}</span>
                            </div>
                        </div>`;
                });
            }
            
            showView('highlights-view');
        }

        document.getElementById('upload-media-form').addEventListener('submit', async e => {
            e.preventDefault();
            const file = document.getElementById('media-file').files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => {
                const newMedia = {
                    id: Date.now(),
                    title: document.getElementById('media-title').value,
                    type: document.getElementById('media-type').value,
                    eventId: document.getElementById('media-event-id').value,
                    url: reader.result
                };
                db.ref('media/' + newMedia.id).set(newMedia);
                e.target.reset();
                alert("Media Uploaded Successfully!");
            };
        });

        function deleteMedia(id) { if (confirm("Delete this media?")) db.ref('media/' + id).remove(); }
        function toggleGalleryVisibility() { db.ref('settings/galleryShow').set(!galleryShow); }
        function openMediaModal(url, type) {
            const container = document.getElementById('video-container');
            if (type === 'video') {
                container.innerHTML = `<video src="${url}" controls autoplay class="w-full h-full max-h-screen"></video>`;
            } else {
                container.innerHTML = `<img src="${url}" class="max-w-full max-h-screen object-contain mx-auto shadow-2xl rounded-xl">`;
            }
            document.getElementById('video-modal').classList.remove('hidden');
        }
        function closeVideoModal() {
            document.getElementById('video-modal').classList.add('hidden');
            document.getElementById('video-container').innerHTML = "";
        }

        document.getElementById('add-event-form').addEventListener('submit', e => {
            e.preventDefault();
            const id = Date.now();
            const event = {
                id, title: document.getElementById('ev-title').value,
                category: document.getElementById('ev-category').value,
                date: document.getElementById('ev-date').value,
                time: document.getElementById('ev-time').value,
                deadline: document.getElementById('ev-deadline').value,
                location: document.getElementById('ev-location').value,
                desc: document.getElementById('ev-desc').value,
                payRequired: document.getElementById('ev-pay-required').checked,
                showHighlights: document.getElementById('ev-show-highlights').checked
            };
            db.ref('events/' + id).set(event);
            e.target.reset();
            alert("Event Published!");
        });

        function renderAdminEvents() {
            const table = document.getElementById('admin-events-table');
            table.innerHTML = "";
            events.forEach(ev => {
                const count = registrations.filter(r => String(r.eventId) === String(ev.id)).length;
                table.innerHTML += `
                    <tr>
                        <td class="px-8 py-5 text-white font-bold">${ev.title}<br><span class="text-[9px] text-gray-500 font-normal uppercase">${ev.category}</span></td>
                        <td class="px-8 py-5 text-xs">${ev.location}</td>
                        <td class="px-8 py-5"><span class="bg-indigo-600/20 px-2 py-1 rounded text-indigo-400 font-bold">${count}</span></td>
                        <td class="px-8 py-5">
                            <div class="flex items-center space-x-4">
                                <button onclick="exportSpecific('${ev.id}', '${ev.title}')" class="text-emerald-500" title="Export CSV"><i class="fas fa-file-excel"></i></button>
                                <button onclick="openQuestionManager('${ev.id}')" class="text-indigo-400" title="Manage Form"><i class="fas fa-list-ol"></i></button>
                                <button onclick="extendDeadline('${ev.firebaseKey}', '${ev.deadline}')" class="text-indigo-400" title="Extend Deadline"><i class="fas fa-clock"></i></button>
                                <button onclick="toggleHighlightsBtn('${ev.firebaseKey}', ${ev.showHighlights !== false})" class="${ev.showHighlights !== false ? 'text-emerald-500' : 'text-gray-500'}" title="Toggle Highlights Button"><i class="fas fa-photo-video"></i></button>
                                <button onclick="deleteEvent('${ev.firebaseKey}', '${ev.id}')" class="text-rose-500" title="Delete Event"><i class="fas fa-trash"></i></button>
                            </div>
                        </td>
                    </tr>`;
            });
        }

        // QUESTION MANAGER LOGIC
        function openQuestionManager(id) {
            activeEventIdForQuestions = id;
            document.getElementById('question-modal').classList.remove('hidden');
            renderQuestions(id);
        }
        function closeQuestionModal() {
            activeEventIdForQuestions = null;
            document.getElementById('question-modal').classList.add('hidden');
        }
        function toggleOptionsInput() {
            const type = document.getElementById('new-q-type').value;
            document.getElementById('mcq-options-container').classList.toggle('hidden', type !== 'mcq');
        }
        function renderQuestions(id) {
            const list = document.getElementById('q-list');
            list.innerHTML = "";
            const eventQs = questions[id] || {};
            Object.keys(eventQs).forEach(key => {
                const q = eventQs[key];
                list.innerHTML += `
                    <div class="bg-white/5 p-4 rounded-xl border border-white/5 flex justify-between items-center">
                        <div>
                            <p class="text-white font-bold">${q.text}</p>
                            <p class="text-[10px] text-indigo-400 uppercase font-black">${q.type}${q.options ? ': ' + q.options : ''}</p>
                        </div>
                        <button onclick="deleteCustomQuestion('${id}', '${key}')" class="text-rose-500"><i class="fas fa-trash"></i></button>
                    </div>`;
            });
        }
        function addCustomQuestion() {
            const text = document.getElementById('new-q-text').value;
            const type = document.getElementById('new-q-type').value;
            const options = document.getElementById('new-q-options').value;
            if (!text) return;
            const q = { text, type, options: type === 'mcq' ? options : null };
            db.ref(`questions/${activeEventIdForQuestions}`).push(q);
            document.getElementById('new-q-text').value = "";
            document.getElementById('new-q-options').value = "";
        }
        function deleteCustomQuestion(evId, qKey) {
            if (confirm("Delete this question?")) db.ref(`questions/${evId}/${qKey}`).remove();
        }

        // REG FORM UPDATE
        function updateRegFormQuestions(evId) {
            // Remove old dynamic fields
            document.querySelectorAll('.dynamic-q').forEach(el => el.remove());
            const eventQs = questions[evId] || {};
            const form = document.getElementById('registration-form');
            const submitBtn = form.querySelector('button[type="submit"]');
            
            Object.keys(eventQs).forEach(key => {
                const q = eventQs[key];
                const wrapper = document.createElement('div');
                wrapper.className = "md:col-span-2 dynamic-q space-y-3";
                wrapper.innerHTML = `<label class="block text-[10px] font-black uppercase text-indigo-400 tracking-widest">${q.text}</label>`;
                
                if (q.type === 'mcq') {
                    let opts = q.options.split(',').map(o => o.trim());
                    let html = `<select name="q_${key}" required class="w-full px-5 py-4 bg-white/5 border border-white/10 rounded-2xl text-white outline-none">`;
                    opts.forEach(o => html += `<option value="${o}" class="bg-slate-900 text-white">${o}</option>`);
                    html += `</select>`;
                    wrapper.innerHTML += html;
                } else {
                    wrapper.innerHTML += `<input type="text" name="q_${key}" required placeholder="Your answer..." class="w-full px-5 py-4 bg-white/5 border border-white/10 rounded-2xl text-white outline-none">`;
                }
                form.insertBefore(wrapper, submitBtn.parentElement ? submitBtn : submitBtn);
            });
        }

        function renderAdminRegs() {
            const table = document.getElementById('admin-regs-table');
            const term = document.getElementById('admin-reg-search').value.toLowerCase();
            const filtered = registrations.filter(r => r.name.toLowerCase().includes(term) || r.studentId.toLowerCase().includes(term) || r.eventName.toLowerCase().includes(term));
            table.innerHTML = "";
            filtered.forEach(r => {
                const receiptBtn = r.receipt ? `<button onclick="openMediaModal('${r.receipt}', 'image')" class="text-indigo-400 hover:text-white transition uppercase text-[9px] font-black tracking-widest bg-indigo-600/10 px-3 py-1.5 rounded-lg border border-indigo-500/20">View Receipt</button>` : `<span class="text-[9px] text-gray-600 font-black uppercase">N/A</span>`;
                const hasAnswers = r.answers && Object.keys(r.answers).length > 0;
                const detailsBtn = hasAnswers ? `<button onclick="viewStudentDetails('${r.firebaseKey}')" class="text-indigo-400 ml-4"><i class="fas fa-eye"></i></button>` : '';
                
                table.innerHTML += `
                    <tr>
                        <td class="px-8 py-5 text-white font-bold">${r.name}${detailsBtn}<br><span class="text-[10px] font-mono text-gray-500">${r.studentId}</span></td>
                        <td class="px-8 py-5 text-xs text-indigo-400 font-bold">${r.eventName}</td>
                        <td class="px-8 py-5">${receiptBtn}</td>
                        <td class="px-8 py-5 text-[10px] text-gray-500 uppercase">${new Date(r.date).toLocaleDateString()}</td>
                        <td class="px-8 py-5"><button onclick="deleteReg('${r.firebaseKey}')" class="text-rose-500/30 hover:text-rose-500"><i class="fas fa-trash"></i></button></td>
                    </tr>`;
            });
        }

        function viewStudentDetails(key) {
            const reg = registrations.find(r => r.firebaseKey === key);
            const content = document.getElementById('details-content');
            content.innerHTML = "";
            if (reg.answers) {
                Object.keys(reg.answers).forEach(qKey => {
                    const q = questions[reg.eventId][qKey];
                    content.innerHTML += `
                        <div class="bg-white/5 p-4 rounded-xl border border-white/10">
                            <p class="text-[10px] text-indigo-400 uppercase font-black mb-1">${q ? q.text : 'Question'}</p>
                            <p class="text-white font-bold">${reg.answers[qKey]}</p>
                        </div>`;
                });
            }
            document.getElementById('details-modal').classList.remove('hidden');
        }
        function closeDetailsModal() { document.getElementById('details-modal').classList.add('hidden'); }

        function renderAdminRegs() {
            const table = document.getElementById('admin-regs-table');
            const term = document.getElementById('admin-reg-search').value.toLowerCase();
            const filtered = registrations.filter(r => r.name.toLowerCase().includes(term) || r.studentId.toLowerCase().includes(term) || r.eventName.toLowerCase().includes(term));
            table.innerHTML = "";
            filtered.forEach(r => {
                const receiptBtn = r.receipt ? `<button onclick="openMediaModal('${r.receipt}', 'image')" class="text-indigo-400 hover:text-white transition uppercase text-[9px] font-black tracking-widest bg-indigo-600/10 px-3 py-1.5 rounded-lg border border-indigo-500/20">View Receipt</button>` : `<span class="text-[9px] text-gray-600 font-black uppercase">N/A</span>`;
                table.innerHTML += `
                    <tr>
                        <td class="px-8 py-5 text-white font-bold">${r.name}<br><span class="text-[10px] font-mono text-gray-500">${r.studentId}</span></td>
                        <td class="px-8 py-5 text-xs text-indigo-400 font-bold">${r.eventName}</td>
                        <td class="px-8 py-5">${receiptBtn}</td>
                        <td class="px-8 py-5 text-[10px] text-gray-500 uppercase">${new Date(r.date).toLocaleDateString()}</td>
                        <td class="px-8 py-5"><button onclick="deleteReg('${r.firebaseKey}')" class="text-rose-500/30 hover:text-rose-500"><i class="fas fa-trash"></i></button></td>
                    </tr>`;
            });
        }

        function exportSpecific(id, title) {
            const list = registrations.filter(r => String(r.eventId) === String(id));
            if (!list.length) return alert("No registrations for this event.");
            downloadCSV(list, `Participants_${title.replace(/\s+/g, '_')}.csv`);
        }

        function exportCSV() {
            if (!registrations.length) return alert("No registrations found.");
            downloadCSV(registrations, "All_Registrations.csv");
        }

        function downloadCSV(data, fileName) {
            let csv = "Full Name,Student ID,Event,Email,Phone,Receipt Provided,Date\n";
            data.forEach(r => {
                const hasReceipt = r.receipt ? "Yes" : "No";
                csv += `"${r.name}","${r.studentId}","${r.eventName}","${r.email}","${r.phone}","${hasReceipt}","${new Date(r.date).toLocaleString().replace(/,/g,'')}"\n`;
            });
            const blob = new Blob(["\uFEFF" + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = fileName;
            link.click();
        }

        function checkStudentStatus() {
            const sid = document.getElementById('search-student-id').value.trim().toUpperCase();
            if(!sid) return;
            const res = document.getElementById('status-results');
            const found = registrations.filter(r => r.studentId.toUpperCase() === sid);
            if (!found.length) res.innerHTML = `<p class="text-rose-500 text-sm font-bold">No registrations found.</p>`;
            else {
                let h = `<h4 class="text-[10px] text-indigo-400 font-black uppercase mb-4">Registrations for ${sid}:</h4>`;
                found.forEach(r => h += `<div class="bg-emerald-500/10 p-4 rounded-xl text-white font-bold mb-2">${r.eventName}</div>`);
                res.innerHTML = h;
            }
        }

        document.getElementById('registration-form').addEventListener('submit', async e => {
            e.preventDefault();
            const evId = document.getElementById('reg-event-select').value;
            const ev = events.find(x => x.id == evId);
            
            const file = document.getElementById('reg-pay-file').files[0];
            let receiptUrl = null;

            if (ev.payRequired) {
                if (!file) {
                    alert("Please upload payment receipt screenshot.");
                    return;
                }
                const reader = new FileReader();
                receiptUrl = await new Promise(resolve => {
                    reader.onload = () => resolve(reader.result);
                    reader.readAsDataURL(file);
                });
            }

            // Capture custom answers
            const answers = {};
            const formData = new FormData(e.target);
            formData.forEach((value, key) => {
                if (key.startsWith('q_')) {
                    answers[key.replace('q_', '')] = value;
                }
            });

            const reg = {
                id: Date.now(), eventId: evId, eventName: ev.title,
                name: document.getElementById('reg-name').value,
                studentId: document.getElementById('reg-id').value,
                email: document.getElementById('reg-email').value,
                phone: document.getElementById('reg-phone').value,
                date: new Date().toISOString(),
                receipt: receiptUrl,
                answers: answers
            };
            db.ref('registrations/' + reg.id).set(reg);
            alert("Registration Successful!"); 
            e.target.reset(); 
            document.getElementById('reg-pay-section').classList.add('hidden');
            document.querySelectorAll('.dynamic-q').forEach(el => el.remove());
            showView('home-view');
        });

        function populateRegDropdown() {
            const s = document.getElementById('reg-event-select');
            if (!s) return;
            s.innerHTML = '<option value="" class="bg-white text-black">Select Event...</option>';
            events.forEach(ev => s.innerHTML += `<option value="${ev.id}" class="bg-white text-black">${ev.title}</option>`);
        }

        function populateMediaEventDropdown() {
            const s = document.getElementById('media-event-id');
            if (!s) return;
            s.innerHTML = '<option value="" class="bg-white text-black">Select Event...</option>';
            events.forEach(ev => s.innerHTML += `<option value="${ev.id}" class="bg-white text-black">${ev.title}</option>`);
        }

        document.getElementById('reg-event-select').addEventListener('change', e => {
            const evId = e.target.value;
            const ev = events.find(x => x.id == evId);
            const paySection = document.getElementById('reg-pay-section');
            if (ev && ev.payRequired) {
                paySection.classList.remove('hidden');
            } else {
                paySection.classList.add('hidden');
            }
            if (evId) updateRegFormQuestions(evId);
        });

        function registerClick(id) { 
            showView('register-view'); 
            document.getElementById('reg-event-select').value = id; 
            document.getElementById('reg-event-select').dispatchEvent(new Event('change'));
        }
        function extendDeadline(fKey, oldDeadline) {
            const newDeadline = prompt("Update Registration Deadline (YYYY-MM-DDTHH:MM):", oldDeadline || "2026-12-31T23:59");
            if (newDeadline) {
                db.ref('events/' + fKey).update({ deadline: newDeadline })
                    .then(() => alert("Deadline Extended Successfully!"))
                    .catch(err => alert("Error: " + err.message));
            }
        }
        function deleteEvent(fKey, evId) { 
            if(confirm("Are you sure you want to delete this event and all its registrations?")) { 
                db.ref('events/' + fKey).remove().then(() => {
                    registrations.forEach(r => {
                        if (String(r.eventId) === String(evId)) {
                            db.ref('registrations/' + r.firebaseKey).remove();
                        }
                    });
                    alert("Event and associated records deleted.");
                });
            } 
        }
        function deleteReg(fKey) { if(confirm("Delete Student registration?")) db.ref('registrations/' + fKey).remove(); }
        function toggleHighlightsBtn(fKey, currentStatus) {
            db.ref('events/' + fKey).update({ showHighlights: !currentStatus });
        }
        function loginAdmin() { if(document.getElementById('admin-pass').value === adminPass) { document.getElementById('admin-login-box').classList.add('hidden'); document.getElementById('admin-dashboard').classList.remove('hidden'); populateMediaEventDropdown(); } else document.getElementById('login-error').classList.remove('hidden'); }
        function logoutAdmin() { document.getElementById('admin-login-box').classList.remove('hidden'); document.getElementById('admin-dashboard').classList.add('hidden'); }
        function changeAdminPassword() { const p = document.getElementById('new-admin-pass').value; if(p.length<5) return; db.ref('settings/pass').set(p); alert("Password Updated!"); }
        function updateNotif() { db.ref('settings/notifText').set(document.getElementById('notif-input').value); }
        function toggleNotifVis() { db.ref('settings/notifShow').set(!notifShow); }
        function toggleMobileMenu() { document.getElementById('mobile-menu').classList.toggle('open'); }

        const createStars = () => { const c = document.getElementById('stars'); for(let i=0; i<150; i++) { const s = document.createElement('div'); s.className='star'; s.style.left=Math.random()*100+'%'; s.style.top=Math.random()*100+'%'; const z=Math.random()*2+1; s.style.width=z+'px'; s.style.height=z+'px'; s.style.setProperty('--duration', (Math.random()*3+2)+'s'); c.appendChild(s); } };

        createStars(); initData();
        setInterval(renderHomeEvents, 60000);
    </script>
</body>
</html>
